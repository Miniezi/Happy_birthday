<!DOCTYPE html>
<html>
<head>
  <title>Змейка</title>
  <style>
    #game-board {
      width: 300px;
      height: 300px;
      border: 1px solid black;
      position: relative;
    }

    .snake {
      width: 10px;
      height: 10px;
      background-color: green;
      position: absolute;
    }

    .food {
      width: 10px;
      height: 10px;
      background-color: red;
      position: absolute;
    }

    #menu {
      width: 100%;
      height: 50px;
      background-color: lightgray;
      position: absolute;
      top: 0;
      left: 0;
    }

    #settings {
      display: none;
      position: absolute;
      top: 60px;
      left: 10px;
      padding: 10px;
      background-color: lightgray;
    }

    #game-log {
      position: absolute;
      top: 120px;
      left: 10px;
    }
  </style>
</head>
<body>
  <div id="menu">
    <button onclick="startGame()">Старт</button>
    <button onclick="showSettings()">Настройки</button>
  </div>

  <div id="settings">
    <h3>Настройки</h3>
    <label for="field-size">Размер поля:</label>
    <select id="field-size">
      <option value="300">Маленький</option>
      <option value="400">Средний</option>
      <option value="500">Большой</option>
    </select>
    <br>
    <button onclick="hideSettings()">Применить</button>
  </div>

  <div id="game-board"></div>

  <div id="game-log">
    <h3>Последние игры</h3>
    <ul id="last-games"></ul>
  </div>

  <script>
    var snakeGame = {
      fieldSize: 300,
      snakeSize: 10,
      snakeSpeed: 150,
      snake: [],
      direction: "right",
      food: {},
      gameRunning: false,
      lastGames: [],

      init: function() {
        var gameBoard = document.getElementById("game-board");
        gameBoard.style.width = this.fieldSize + "px";
        gameBoard.style.height = this.fieldSize + "px";

        document.addEventListener("keydown", this.changeDirection);

        this.createSnake();
        this.createFood();
        this.drawSnake();
        this.drawFood();
      },

      createSnake: function() {
        var initialSnakeSize = 5;
        var initialSnakeX = Math.floor(this.fieldSize / 2 / this.snakeSize) * this.snakeSize;

        for (var i = initialSnakeSize - 1; i >= 0; i--) {
          this.snake.push({ x: initialSnakeX + i * this.snakeSize, y: 0 });
        }
      },

      drawSnake: function() {
        var gameBoard = document.getElementById("game-board");

        while (gameBoard.firstChild) {
          gameBoard.removeChild(gameBoard.firstChild);
        }

        for (var i = 0; i < this.snake.length; i++) {
          var snakeElement = document.createElement("div");
          snakeElement.style.width = this.snakeSize + "px";
          snakeElement.style.height = this.snakeSize + "px";
          snakeElement.style.backgroundColor = "green";
          snakeElement.style.position = "absolute";
          snakeElement.style.left = this.snake[i].x + "px";
          snakeElement.style.top = this.snake[i].y + "px";
          gameBoard.appendChild(snakeElement);
        }
      },

      createFood: function() {
        var maxCells = Math.floor(this.fieldSize / this.snakeSize);
        var randomX = Math.floor(Math.random() * maxCells) * this.snakeSize;
        var randomY = Math.floor(Math.random() * maxCells) * this.snakeSize;

        this.food = { x: randomX, y: randomY };
      },

      drawFood: function() {
        var gameBoard = document.getElementById("game-board");
        var foodElement = document.createElement("div");
        foodElement.style.width = this.snakeSize + "px";
        foodElement.style.height = this.snakeSize + "px";
        foodElement.style.backgroundColor = "red";
        foodElement.style.position = "absolute";
        foodElement.style.left = this.food.x + "px";
        foodElement.style.top = this.food.y + "px";
        gameBoard.appendChild(foodElement);
      },

      changeDirection: function(event) {
        switch (event.keyCode) {
          case 37:
            if (snakeGame.direction !== "right") {
              snakeGame.direction = "left";
            }
            break;
          case 38:
            if (snakeGame.direction !== "down") {
              snakeGame.direction = "up";
            }
            break;
          case 39:
            if (snakeGame.direction !== "left") {
              snakeGame.direction = "right";
            }
            break;
          case 40:
            if (snakeGame.direction !== "up") {
              snakeGame.direction = "down";
            }
            break;
        }
      },

      moveSnake: function() {
        var head = { x: this.snake[0].x, y: this.snake[0].y };

        switch (this.direction) {
          case "left":
            head.x -= this.snakeSize;
            break;
          case "up":
            head.y -= this.snakeSize;
            break;
          case "right":
            head.x += this.snakeSize;
            break;
          case "down":
            head.y += this.snakeSize;
            break;
        }

        this.snake.unshift(head);

        if (head.x === this.food.x && head.y === this.food.y) {
          this.createFood();
        } else {
          this.snake.pop();
        }
      },

      checkCollision: function() {
        var head = this.snake[0];

        // Check collision with walls
        if (
          head.x < 0 ||
          head.x >= this.fieldSize ||
          head.y < 0 ||
          head.y >= this.fieldSize
        ) {
          return true;
        }

        // Check collision with self
        for (var i = 1; i < this.snake.length; i++) {
          if (head.x === this.snake[i].x && head.y === this.snake[i].y) {
            return true;
          }
        }

        return false;
      },

      updateGameLog: function(result) {
        var lastGamesElement = document.getElementById("last-games");
        var resultText = result ? "Поражение" : "Победа";
        var gameResult = document.createElement("li");
        gameResult.innerText = resultText;
        lastGamesElement.insertBefore(gameResult, lastGamesElement.firstChild);

        if (lastGamesElement.childElementCount > 3) {
          lastGamesElement.removeChild(lastGamesElement.lastChild);
        }
      },

      resetGame: function() {
        this.snake = [];
        this.direction = "right";
        this.createSnake();
        this.createFood();
        this.drawSnake();
        this.drawFood();
        this.gameRunning = false;
      },

      startGame: function() {
        if (this.gameRunning) {
          return;
        }

        this.gameRunning = true;
        var self = this;

        var gameInterval = setInterval(function() {
          self.moveSnake();
          self.drawSnake();

          if (self.checkCollision()) {
            clearInterval(gameInterval);
            self.updateGameLog(true);
            self.resetGame();
          }
        }, this.snakeSpeed);
      },

      showSettings: function() {
        document.getElementById("settings").style.display = "block";
      },

      hideSettings: function() {
        var fieldSizeSelect = document.getElementById("field-size");
        this.fieldSize = parseInt(fieldSizeSelect.value);
        document.getElementById("settings").style.display = "none";
      }
    };

    snakeGame.init();
  </script>
</body>
</html>
